"use strict";(self["webpackChunknovel_assistant_frontend"]=self["webpackChunknovel_assistant_frontend"]||[]).push([[446],{3339:function(e,a,l){var s=l(412);const t={async getDashboardStats(){return s.A.get("/admin/dashboard")},async getAllUsers(){return s.A.get("/admin/users")},async getUserDetail(e){if(!e)throw new Error("用户ID不能为空");return s.A.get(`/admin/users/${e}`)},async updateUserStatus(e,a){if(!e)throw new Error("用户ID不能为空");return s.A.put(`/admin/users/${e}/status`,{enabled:a})},async updateUserInfo(e,a){if(!e)throw new Error("用户ID不能为空");return s.A.put(`/admin/users/${e}`,a)},async deleteUser(e){if(!e)throw new Error("用户ID不能为空");return s.A.delete(`/admin/users/${e}`)},async getAllNovels(){return s.A.get("/admin/novels")},async deleteNovel(e){if(!e)throw new Error("小说ID不能为空");return s.A.delete(`/admin/novels/${e}`)},async getSystemLogs(e=0,a=20,l={}){let t=`/admin/logs?page=${e}&size=${a}`;return l.level&&"ALL"!==l.level&&(t+=`&level=${l.level}`),l.startDate&&(t+=`&startDate=${l.startDate}`),l.endDate&&(t+=`&endDate=${l.endDate}`),l.query&&(t+=`&query=${encodeURIComponent(l.query)}`),l.userId&&(t+=`&userId=${String(l.userId)}`),console.log("系统日志请求URL:",t),s.A.get(t)},async clearSystemCache(){return s.A.post("/admin/cache/clear")}};a.A=t},9065:function(e,a,l){l.r(a),l.d(a,{default:function(){return K}});l(8111),l(2489),l(116);var s=l(6768),t=l(144),r=l(4232),n=l(5130),o=l(1219),u=l(2933),d=l(7477),i=l(3339);const c={class:"user-management-container"},v={class:"card-header"},m={class:"header-actions"},p={key:0,class:"loading-container"},k={key:1,class:"user-table-container"},w={key:0,class:"user-detail"},b={class:"detail-item"},g={class:"detail-value"},f={class:"detail-item"},y={class:"detail-value"},_={class:"detail-item"},L={class:"detail-value"},h={class:"detail-item"},F={class:"detail-value"},C={class:"detail-item"},A={class:"detail-value"},D={class:"detail-item"},$={class:"detail-value"},I={class:"detail-item"},R={class:"detail-value"},E={class:"detail-item"},U={class:"detail-value"},W={class:"dialog-footer"};var V={__name:"UserManagementView",setup(e){const a=(0,t.KR)(!0),l=(0,t.KR)([]),V=(0,t.KR)(""),P=(0,t.KR)(null),x=(0,t.KR)(!1),K=(0,t.KR)(!1),S=(0,t.KR)(null),X=(0,t.KR)(null),q=(0,t.KR)({newPassword:"",confirmPassword:""}),z=(0,t.KR)(!1),N={newPassword:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a,l)=>{a!==q.value.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},B=async()=>{a.value=!0;try{const e=await i.A.getAllUsers();console.log("获取用户列表响应:",e),e&&e.users?l.value=e.users:Array.isArray(e)?l.value=e:(l.value=[],console.warn("用户列表API返回格式异常:",e))}catch(e){console.error("获取用户列表失败:",e),o.nk.error("获取用户列表失败: "+(e.message||"未知错误")),l.value=[]}finally{a.value=!1}},M=()=>{B()},O=()=>{const e=V.value.toLowerCase().trim();return e?l.value.filter((a=>a.username.toLowerCase().includes(e)||a.email.toLowerCase().includes(e)||a.nickname&&a.nickname.toLowerCase().includes(e))):l.value},T=(0,s.EW)((()=>{const e=V.value.toLowerCase().trim();return e?l.value.filter((a=>a.username.toLowerCase().includes(e)||a.email.toLowerCase().includes(e)||a.nickname&&a.nickname.toLowerCase().includes(e))):l.value})),j=e=>{if(!e)return"未知";const a=new Date(e);return a.toLocaleString()},Q=e=>{switch(e){case"ROLE_ADMIN":return"管理员";case"ROLE_USER":return"用户";default:return e}},G=e=>{P.value=e,x.value=!0},H=e=>{G(e)},J=async e=>{if(e)try{const a=!e.enabled,s=a?"启用":"禁用";await u.s.confirm(`确定要${s}用户 "${e.username}" 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),console.log(`正在发送请求更新用户 ${e.id} 的状态为 ${a}`);const t=await i.A.updateUserStatus(e.id,a);if(console.log("更新用户状态响应:",t),await B(),P.value&&P.value.id===e.id){const a=l.value.find((a=>a.id===e.id));a&&(P.value=a)}o.nk.success(`用户已${s}`)}catch(a){if("cancel"===a)return void console.log("用户取消了操作");console.error("更新用户状态失败:",a);let e="更新用户状态失败";a.response&&a.response.data?a.response.data.message?e=a.response.data.message:a.response.data.error&&(e=a.response.data.error):a.message&&(e=a.message),o.nk.error(e)}},Y=async e=>{if(e)try{await u.s.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可恢复！`,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"danger"}),await i.A.deleteUser(e.id),l.value=l.value.filter((a=>a.id!==e.id)),P.value&&P.value.id===e.id&&(x.value=!1),o.nk.success("用户已删除")}catch(a){"cancel"!==a&&(console.error("删除用户失败:",a),o.nk.error("删除用户失败"))}},Z=e=>{S.value=e,q.value={newPassword:"",confirmPassword:""},K.value=!0},ee=async()=>{X.value&&await X.value.validate((async e=>{if(e)try{z.value=!0,await i.A.updateUserInfo(S.value.id,{password:q.value.newPassword}),K.value=!1,o.nk.success("密码修改成功"),B()}catch(a){console.error("修改密码失败",a),o.nk.error(`修改密码失败: ${a.response?.data?.message||a.message}`)}finally{z.value=!1}}))};return(0,s.sV)((()=>{B()})),(e,l)=>{const o=(0,s.g2)("el-icon"),u=(0,s.g2)("el-input"),i=(0,s.g2)("el-button"),B=(0,s.g2)("el-skeleton"),ae=(0,s.g2)("el-table-column"),le=(0,s.g2)("el-tag"),se=(0,s.g2)("el-table"),te=(0,s.g2)("el-card"),re=(0,s.g2)("el-dialog"),ne=(0,s.g2)("el-form-item"),oe=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)("div",c,[(0,s.bF)(te,{class:"user-management-card"},{header:(0,s.k6)((()=>[(0,s.Lk)("div",v,[l[10]||(l[10]=(0,s.Lk)("h2",null,"用户管理",-1)),(0,s.Lk)("div",m,[(0,s.bF)(u,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value=e),placeholder:"搜索用户名或邮箱",clearable:"",onClear:O,onInput:O,style:{width:"300px","margin-right":"10px"}},{prefix:(0,s.k6)((()=>[(0,s.bF)(o,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,t.R1)(d.vji))])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(i,{type:"primary",onClick:M},{default:(0,s.k6)((()=>l[9]||(l[9]=[(0,s.eW)("刷新")]))),_:1})])])])),default:(0,s.k6)((()=>[a.value?((0,s.uX)(),(0,s.CE)("div",p,[(0,s.bF)(B,{rows:10,animated:""})])):((0,s.uX)(),(0,s.CE)("div",k,[(0,s.bF)(se,{data:T.value,style:{width:"100%"},border:"",stripe:"","highlight-current-row":"",onRowClick:H},{default:(0,s.k6)((()=>[(0,s.bF)(ae,{prop:"id",label:"ID",width:"80"}),(0,s.bF)(ae,{prop:"username",label:"用户名",width:"150"}),(0,s.bF)(ae,{prop:"email",label:"邮箱",width:"200"}),(0,s.bF)(ae,{prop:"nickname",label:"昵称"}),(0,s.bF)(ae,{label:"状态",width:"100"},{default:(0,s.k6)((e=>[(0,s.bF)(le,{type:e.row.enabled?"success":"danger"},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(e.row.enabled?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),(0,s.bF)(ae,{label:"角色",width:"120"},{default:(0,s.k6)((e=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.row.roles,(e=>((0,s.uX)(),(0,s.Wv)(le,{key:e.name,type:"ROLE_ADMIN"===e.name?"danger":"primary",style:{"margin-right":"5px"}},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(Q(e.name)),1)])),_:2},1032,["type"])))),128))])),_:1}),(0,s.bF)(ae,{label:"注册时间",width:"180"},{default:(0,s.k6)((e=>[(0,s.eW)((0,r.v_)(j(e.row.createdAt)),1)])),_:1}),(0,s.bF)(ae,{label:"操作",width:"300",fixed:"right"},{default:(0,s.k6)((e=>[(0,s.bF)(i,{size:"small",type:"primary",onClick:(0,n.D$)((a=>G(e.row)),["stop"])},{default:(0,s.k6)((()=>l[11]||(l[11]=[(0,s.eW)(" 查看 ")]))),_:2},1032,["onClick"]),(0,s.bF)(i,{size:"small",type:"warning",onClick:(0,n.D$)((a=>Z(e.row)),["stop"])},{default:(0,s.k6)((()=>l[12]||(l[12]=[(0,s.eW)(" 修改密码 ")]))),_:2},1032,["onClick"]),(0,s.bF)(i,{size:"small",type:e.row.enabled?"danger":"success",onClick:(0,n.D$)((a=>J(e.row)),["stop"])},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(e.row.enabled?"禁用":"启用"),1)])),_:2},1032,["type","onClick"]),(0,s.bF)(i,{size:"small",type:"danger",onClick:(0,n.D$)((a=>Y(e.row)),["stop"])},{default:(0,s.k6)((()=>l[13]||(l[13]=[(0,s.eW)(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]))])),_:1}),(0,s.bF)(re,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=e=>x.value=e),title:"用户详情",width:"600px"},{footer:(0,s.k6)((()=>[(0,s.Lk)("span",W,[(0,s.bF)(i,{onClick:l[1]||(l[1]=e=>x.value=!1)},{default:(0,s.k6)((()=>l[22]||(l[22]=[(0,s.eW)("关闭")]))),_:1}),(0,s.bF)(i,{type:"primary",onClick:l[2]||(l[2]=e=>Z(P.value))},{default:(0,s.k6)((()=>l[23]||(l[23]=[(0,s.eW)(" 修改密码 ")]))),_:1}),(0,s.bF)(i,{type:P.value?.enabled?"danger":"success",onClick:l[3]||(l[3]=e=>J(P.value))},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(P.value?.enabled?"禁用账号":"启用账号"),1)])),_:1},8,["type"])])])),default:(0,s.k6)((()=>[P.value?((0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("div",b,[l[14]||(l[14]=(0,s.Lk)("span",{class:"detail-label"},"ID:",-1)),(0,s.Lk)("span",g,(0,r.v_)(P.value.id),1)]),(0,s.Lk)("div",f,[l[15]||(l[15]=(0,s.Lk)("span",{class:"detail-label"},"用户名:",-1)),(0,s.Lk)("span",y,(0,r.v_)(P.value.username),1)]),(0,s.Lk)("div",_,[l[16]||(l[16]=(0,s.Lk)("span",{class:"detail-label"},"邮箱:",-1)),(0,s.Lk)("span",L,(0,r.v_)(P.value.email),1)]),(0,s.Lk)("div",h,[l[17]||(l[17]=(0,s.Lk)("span",{class:"detail-label"},"昵称:",-1)),(0,s.Lk)("span",F,(0,r.v_)(P.value.nickname||"未设置"),1)]),(0,s.Lk)("div",C,[l[18]||(l[18]=(0,s.Lk)("span",{class:"detail-label"},"状态:",-1)),(0,s.Lk)("span",A,[(0,s.bF)(le,{type:P.value.enabled?"success":"danger"},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(P.value.enabled?"启用":"禁用"),1)])),_:1},8,["type"])])]),(0,s.Lk)("div",D,[l[19]||(l[19]=(0,s.Lk)("span",{class:"detail-label"},"角色:",-1)),(0,s.Lk)("span",$,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(P.value.roles,(e=>((0,s.uX)(),(0,s.Wv)(le,{key:e.name,type:"ROLE_ADMIN"===e.name?"danger":"primary",style:{"margin-right":"5px"}},{default:(0,s.k6)((()=>[(0,s.eW)((0,r.v_)(Q(e.name)),1)])),_:2},1032,["type"])))),128))])]),(0,s.Lk)("div",I,[l[20]||(l[20]=(0,s.Lk)("span",{class:"detail-label"},"注册时间:",-1)),(0,s.Lk)("span",R,(0,r.v_)(j(P.value.createdAt)),1)]),(0,s.Lk)("div",E,[l[21]||(l[21]=(0,s.Lk)("span",{class:"detail-label"},"最后登录:",-1)),(0,s.Lk)("span",U,(0,r.v_)(P.value.lastLoginAt?j(P.value.lastLoginAt):"从未登录"),1)])])):(0,s.Q3)("",!0)])),_:1},8,["modelValue"]),(0,s.bF)(re,{modelValue:K.value,"onUpdate:modelValue":l[8]||(l[8]=e=>K.value=e),title:"修改用户密码",width:"500px"},{footer:(0,s.k6)((()=>[(0,s.Lk)("span",null,[(0,s.bF)(i,{onClick:l[7]||(l[7]=e=>K.value=!1)},{default:(0,s.k6)((()=>l[24]||(l[24]=[(0,s.eW)("取消")]))),_:1}),(0,s.bF)(i,{type:"primary",loading:z.value,onClick:ee},{default:(0,s.k6)((()=>l[25]||(l[25]=[(0,s.eW)(" 保存 ")]))),_:1},8,["loading"])])])),default:(0,s.k6)((()=>[(0,s.bF)(oe,{ref_key:"passwordForm",ref:X,model:q.value,rules:N,"label-width":"120px"},{default:(0,s.k6)((()=>[(0,s.bF)(ne,{label:"用户名"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{value:S.value?S.value.username:"",disabled:""},null,8,["value"])])),_:1}),(0,s.bF)(ne,{label:"新密码",prop:"newPassword"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{modelValue:q.value.newPassword,"onUpdate:modelValue":l[5]||(l[5]=e=>q.value.newPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(ne,{label:"确认密码",prop:"confirmPassword"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{modelValue:q.value.confirmPassword,"onUpdate:modelValue":l[6]||(l[6]=e=>q.value.confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},P=l(1241);const x=(0,P.A)(V,[["__scopeId","data-v-a288c382"]]);var K=x}}]);