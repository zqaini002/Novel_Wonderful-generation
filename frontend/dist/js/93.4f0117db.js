"use strict";(self["webpackChunknovel_assistant_frontend"]=self["webpackChunknovel_assistant_frontend"]||[]).push([[93],{3339:function(e,t,a){var r=a(412);const n={async getDashboardStats(){return r.A.get("/admin/dashboard")},async getAllUsers(){return r.A.get("/admin/users")},async getUserDetail(e){if(!e)throw new Error("用户ID不能为空");return r.A.get(`/admin/users/${e}`)},async updateUserStatus(e,t){if(!e)throw new Error("用户ID不能为空");return r.A.put(`/admin/users/${e}/status`,{enabled:t})},async updateUserInfo(e,t){if(!e)throw new Error("用户ID不能为空");return r.A.put(`/admin/users/${e}`,t)},async deleteUser(e){if(!e)throw new Error("用户ID不能为空");return r.A.delete(`/admin/users/${e}`)},async getAllNovels(){return r.A.get("/admin/novels")},async deleteNovel(e){if(!e)throw new Error("小说ID不能为空");return r.A.delete(`/admin/novels/${e}`)},async getSystemLogs(e=0,t=20,a={}){let n=`/admin/logs?page=${e}&size=${t}`;return a.level&&"ALL"!==a.level&&(n+=`&level=${a.level}`),a.startDate&&(n+=`&startDate=${a.startDate}`),a.endDate&&(n+=`&endDate=${a.endDate}`),a.query&&(n+=`&query=${encodeURIComponent(a.query)}`),a.userId&&(n+=`&userId=${String(a.userId)}`),console.log("系统日志请求URL:",n),r.A.get(n)},async clearSystemCache(){return r.A.post("/admin/cache/clear")}};t.A=n},8093:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});a(4114),a(8111),a(2489);var r=a(6768),n=a(144),l=a(4232),s=a(5130),o=a(1387),u=a(1219),i=a(2933),c=a(7477),d=a(3339);const v={class:"novel-management-container"},g={class:"card-header"},h={class:"header-actions"},w={key:0,class:"loading-container"},p={key:1,class:"novel-table-container"},b={class:"pagination-container"};var f={__name:"NovelManagementView",setup(e){const t=(0,o.rd)(),a=(0,n.KR)(!0),f=(0,n.KR)([]),k=(0,n.KR)(""),m=(0,n.KR)(1),y=(0,n.KR)(20),C=(0,n.KR)(0),_=async()=>{a.value=!0;try{const e=await d.A.getAllNovels();console.log("获取小说列表响应:",e),e&&e.novels?(f.value=e.novels,C.value=e.total||f.value.length):Array.isArray(e)?(f.value=e,C.value=e.length):(f.value=[],C.value=0,console.warn("小说列表API返回格式异常:",e))}catch(e){console.error("获取小说列表失败:",e),u.nk.error("获取小说列表失败: "+(e.message||"未知错误")),f.value=[],C.value=0}finally{a.value=!1}},A=()=>{_()},D=()=>{const e=k.value.toLowerCase().trim();return e?f.value.filter((t=>t.title.toLowerCase().includes(e)||t.author&&t.author.toLowerCase().includes(e))):f.value},F=(0,r.EW)((()=>{const e=k.value.toLowerCase().trim();return e?f.value.filter((t=>t.title.toLowerCase().includes(e)||t.author&&t.author.toLowerCase().includes(e))):f.value})),E=e=>{if(!e)return"未知";const t=new Date(e);return t.toLocaleString()},I=e=>{switch(e){case"PROCESSING":return"处理中";case"COMPLETED":return"已完成";case"FAILED":return"处理失败";case"QUEUED":return"等待处理";default:return e}},L=e=>{switch(e){case"PROCESSING":return"warning";case"COMPLETED":return"success";case"FAILED":return"danger";case"QUEUED":return"info";default:return"info"}},$=e=>e?e<1e4?e.toString():(e/1e4).toFixed(2)+"万":"0",S=e=>{t.push(`/novel/${e}`)},R=e=>{i.s.confirm(`确定要重新处理小说"${e.title}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{u.nk.success("已发送重新处理请求")})).catch((()=>{}))},U=e=>{i.s.confirm(`确定要删除小说"${e.title}"吗？此操作不可恢复！`,"危险操作",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}).then((async()=>{try{await d.A.deleteNovel(e.id),u.nk.success("小说删除成功"),_()}catch(t){console.error("删除小说失败:",t),u.nk.error("删除小说失败")}})).catch((()=>{}))},x=e=>{S(e.id)},z=e=>{y.value=e},W=e=>{m.value=e};return(0,r.sV)((()=>{_()})),(e,t)=>{const o=(0,r.g2)("el-icon"),u=(0,r.g2)("el-input"),i=(0,r.g2)("el-button"),d=(0,r.g2)("el-skeleton"),f=(0,r.g2)("el-table-column"),m=(0,r.g2)("el-tag"),_=(0,r.g2)("el-table"),N=(0,r.g2)("el-pagination"),K=(0,r.g2)("el-card");return(0,r.uX)(),(0,r.CE)("div",v,[(0,r.bF)(K,{class:"novel-management-card"},{header:(0,r.k6)((()=>[(0,r.Lk)("div",g,[t[2]||(t[2]=(0,r.Lk)("h2",null,"小说管理",-1)),(0,r.Lk)("div",h,[(0,r.bF)(u,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),placeholder:"搜索小说标题或作者",clearable:"",onClear:D,onInput:D,style:{width:"300px","margin-right":"10px"}},{prefix:(0,r.k6)((()=>[(0,r.bF)(o,null,{default:(0,r.k6)((()=>[(0,r.bF)((0,n.R1)(c.vji))])),_:1})])),_:1},8,["modelValue"]),(0,r.bF)(i,{type:"primary",onClick:A},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)("刷新")]))),_:1})])])])),default:(0,r.k6)((()=>[a.value?((0,r.uX)(),(0,r.CE)("div",w,[(0,r.bF)(d,{rows:10,animated:""})])):((0,r.uX)(),(0,r.CE)("div",p,[(0,r.bF)(_,{data:F.value,style:{width:"100%"},border:"",stripe:"","highlight-current-row":"",onRowClick:x},{default:(0,r.k6)((()=>[(0,r.bF)(f,{prop:"id",label:"ID",width:"80"}),(0,r.bF)(f,{prop:"title",label:"标题",width:"200"}),(0,r.bF)(f,{prop:"author",label:"作者",width:"150"}),(0,r.bF)(f,{label:"状态",width:"120"},{default:(0,r.k6)((e=>[(0,r.bF)(m,{type:L(e.row.status)},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(I(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),(0,r.bF)(f,{label:"章节数",width:"100"},{default:(0,r.k6)((e=>[(0,r.eW)((0,l.v_)(e.row.chapterCount||0),1)])),_:1}),(0,r.bF)(f,{label:"字数",width:"120"},{default:(0,r.k6)((e=>[(0,r.eW)((0,l.v_)($(e.row.wordCount)),1)])),_:1}),(0,r.bF)(f,{label:"上传时间",width:"180"},{default:(0,r.k6)((e=>[(0,r.eW)((0,l.v_)(E(e.row.createdAt)),1)])),_:1}),(0,r.bF)(f,{label:"操作",width:"220",fixed:"right"},{default:(0,r.k6)((e=>[(0,r.bF)(i,{size:"small",type:"primary",onClick:(0,s.D$)((t=>S(e.row.id)),["stop"])},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)(" 查看 ")]))),_:2},1032,["onClick"]),(0,r.bF)(i,{size:"small",type:"warning",onClick:(0,s.D$)((t=>R(e.row)),["stop"]),disabled:"PROCESSING"===e.row.status},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" 重新处理 ")]))),_:2},1032,["onClick","disabled"]),(0,r.bF)(i,{size:"small",type:"danger",onClick:(0,s.D$)((t=>U(e.row)),["stop"])},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,r.Lk)("div",b,[(0,r.bF)(N,{background:"",layout:"prev, pager, next, sizes, total",total:C.value,"page-size":y.value,"page-sizes":[10,20,50,100],onSizeChange:z,onCurrentChange:W},null,8,["total","page-size"])])]))])),_:1})])}}},k=a(1241);const m=(0,k.A)(f,[["__scopeId","data-v-3c7b6ef0"]]);var y=m}}]);