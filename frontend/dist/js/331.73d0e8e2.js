"use strict";(self["webpackChunknovel_assistant_frontend"]=self["webpackChunknovel_assistant_frontend"]||[]).push([[331],{3339:function(e,a,l){var t=l(412);const r={async getDashboardStats(){return t.A.get("/admin/dashboard")},async getAllUsers(){return t.A.get("/admin/users")},async getUserDetail(e){if(!e)throw new Error("用户ID不能为空");return t.A.get(`/admin/users/${e}`)},async updateUserStatus(e,a){if(!e)throw new Error("用户ID不能为空");return t.A.put(`/admin/users/${e}/status`,{enabled:a})},async updateUserInfo(e,a){if(!e)throw new Error("用户ID不能为空");return t.A.put(`/admin/users/${e}`,a)},async deleteUser(e){if(!e)throw new Error("用户ID不能为空");return t.A.delete(`/admin/users/${e}`)},async getAllNovels(){return t.A.get("/admin/novels")},async deleteNovel(e){if(!e)throw new Error("小说ID不能为空");return t.A.delete(`/admin/novels/${e}`)},async getSystemLogs(e=0,a=20,l={}){let r=`/admin/logs?page=${e}&size=${a}`;return l.level&&"ALL"!==l.level&&(r+=`&level=${l.level}`),l.startDate&&(r+=`&startDate=${l.startDate}`),l.endDate&&(r+=`&endDate=${l.endDate}`),l.query&&(r+=`&query=${encodeURIComponent(l.query)}`),l.userId&&(r+=`&userId=${String(l.userId)}`),console.log("系统日志请求URL:",r),t.A.get(r)},async clearSystemCache(){return t.A.post("/admin/cache/clear")}};a.A=r},6331:function(e,a,l){l.r(a),l.d(a,{default:function(){return D}});var t=l(6768),r=l(144),n=l(4232),s=l(1219),o=l(7477),u=l(3339);const d={class:"system-logs-container"},i={class:"card-header"},c={class:"header-actions"},g={key:0,class:"loading-container"},v={key:1,class:"logs-table-container"},p={class:"log-details"},b={key:0,class:"log-stack"},w={key:1,class:"log-params"},m={class:"pagination-container"};var h={__name:"SystemLogsView",setup(e){const a=(0,r.KR)(!0),l=(0,r.KR)([]),h=(0,r.KR)(""),y=(0,r.KR)("ALL"),k=(0,r.KR)(null),D=(0,r.KR)(0),f=(0,r.KR)(20),F=(0,r.KR)(0),R=async()=>{a.value=!0;try{const e={};if(y.value&&"ALL"!==y.value&&(e.level=y.value),k.value&&2===k.value.length){const a=new Date(k.value[0]);a.setHours(0,0,0,0),e.startDate=a.toISOString().split("T")[0];const l=new Date(k.value[1]);l.setHours(23,59,59,999),e.endDate=l.toISOString().split("T")[0],console.log("日期范围:",{startDate:a.toISOString(),endDate:l.toISOString(),startDateStr:e.startDate,endDateStr:e.endDate})}h.value&&(e.query=h.value),console.log("请求系统日志参数:",{page:D.value,size:f.value,filters:e});let a=`/admin/logs?page=${D.value}&size=${f.value}`;e.level&&(a+=`&level=${e.level}`),e.startDate&&(a+=`&startDate=${e.startDate}`),e.endDate&&(a+=`&endDate=${e.endDate}`),e.query&&(a+=`&query=${encodeURIComponent(e.query)}`),console.log("请求URL:",a);const t=await u.A.getSystemLogs(D.value,f.value,e);if(console.log("获取系统日志响应:",t),void 0===t||null===t)return console.warn("系统日志API返回undefined或null"),l.value=[],F.value=0,void s.nk.warning("系统日志返回为空");t&&t.logs?(l.value=t.logs,F.value=t.total||0,console.log(`成功获取系统日志, 共${F.value}条记录`),l.value.length>0?console.log("第一条日志记录:",l.value[0]):console.log("日志记录为空数组")):(l.value=[],F.value=0,console.warn("系统日志API返回格式异常:",t),console.warn("响应数据类型:",typeof t),console.warn("响应数据结构:",Object.keys(t||{})),s.nk.warning("系统日志数据格式异常"))}catch(e){console.error("获取系统日志失败:",e),console.error("错误类型:",e.name),console.error("错误消息:",e.message),e.response&&(console.error("错误响应状态:",e.response.status),console.error("错误响应数据:",e.response.data)),s.nk.error("获取系统日志失败: "+(e.message||"未知错误")),l.value=[],F.value=0}finally{a.value=!1}},A=e=>{if(!e)return"未知";const a=new Date(e);return a.toLocaleString()},L=e=>{switch(e){case"ERROR":return"danger";case"WARN":return"warning";case"INFO":return"info";case"DEBUG":return"success";default:return""}},I=e=>{f.value=e,R()},_=e=>{D.value=e-1,R()};return(0,t.sV)((()=>{const e=new Date,a=new Date;a.setDate(e.getDate()-7),k.value=[a,e],R()})),(e,s)=>{const u=(0,t.g2)("el-option"),D=(0,t.g2)("el-select"),S=(0,t.g2)("el-date-picker"),$=(0,t.g2)("el-icon"),C=(0,t.g2)("el-input"),E=(0,t.g2)("el-button"),U=(0,t.g2)("el-skeleton"),O=(0,t.g2)("el-table-column"),V=(0,t.g2)("el-tag"),x=(0,t.g2)("el-table"),N=(0,t.g2)("el-pagination"),z=(0,t.g2)("el-card");return(0,t.uX)(),(0,t.CE)("div",d,[(0,t.bF)(z,{class:"system-logs-card"},{header:(0,t.k6)((()=>[(0,t.Lk)("div",i,[s[4]||(s[4]=(0,t.Lk)("h2",null,"系统日志",-1)),(0,t.Lk)("div",c,[(0,t.bF)(D,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=e=>y.value=e),placeholder:"日志级别",style:{width:"120px","margin-right":"10px"},onChange:R},{default:(0,t.k6)((()=>[(0,t.bF)(u,{label:"全部",value:"ALL"}),(0,t.bF)(u,{label:"INFO",value:"INFO"}),(0,t.bF)(u,{label:"WARN",value:"WARN"}),(0,t.bF)(u,{label:"ERROR",value:"ERROR"}),(0,t.bF)(u,{label:"DEBUG",value:"DEBUG"})])),_:1},8,["modelValue"]),(0,t.bF)(S,{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=e=>k.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD",style:{width:"300px","margin-right":"10px"},onChange:R},null,8,["modelValue"]),(0,t.bF)(C,{modelValue:h.value,"onUpdate:modelValue":s[2]||(s[2]=e=>h.value=e),placeholder:"搜索日志内容",clearable:"",onClear:R,style:{width:"200px","margin-right":"10px"}},{prefix:(0,t.k6)((()=>[(0,t.bF)($,null,{default:(0,t.k6)((()=>[(0,t.bF)((0,r.R1)(o.vji))])),_:1})])),_:1},8,["modelValue"]),(0,t.bF)(E,{type:"primary",onClick:R},{default:(0,t.k6)((()=>s[3]||(s[3]=[(0,t.eW)("刷新")]))),_:1})])])])),default:(0,t.k6)((()=>[a.value?((0,t.uX)(),(0,t.CE)("div",g,[(0,t.bF)(U,{rows:10,animated:""})])):((0,t.uX)(),(0,t.CE)("div",v,[(0,t.bF)(x,{data:l.value,style:{width:"100%"},border:"",stripe:""},{default:(0,t.k6)((()=>[(0,t.bF)(O,{type:"expand"},{default:(0,t.k6)((e=>[(0,t.Lk)("div",p,[e.row.stackTrace?((0,t.uX)(),(0,t.CE)("div",b,[s[5]||(s[5]=(0,t.Lk)("p",{class:"stack-title"},"堆栈跟踪:",-1)),(0,t.Lk)("pre",null,(0,n.v_)(e.row.stackTrace),1)])):(0,t.Q3)("",!0),e.row.params?((0,t.uX)(),(0,t.CE)("div",w,[s[6]||(s[6]=(0,t.Lk)("p",{class:"params-title"},"参数:",-1)),(0,t.Lk)("pre",null,(0,n.v_)(JSON.stringify(e.row.params,null,2)),1)])):(0,t.Q3)("",!0)])])),_:1}),(0,t.bF)(O,{label:"时间",width:"180"},{default:(0,t.k6)((e=>[(0,t.eW)((0,n.v_)(A(e.row.timestamp)),1)])),_:1}),(0,t.bF)(O,{prop:"level",label:"级别",width:"100"},{default:(0,t.k6)((e=>[(0,t.bF)(V,{type:L(e.row.level)},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.row.level),1)])),_:2},1032,["type"])])),_:1}),(0,t.bF)(O,{prop:"logger",label:"Logger",width:"180"}),(0,t.bF)(O,{prop:"thread",label:"线程",width:"150"}),(0,t.bF)(O,{prop:"message",label:"消息","min-width":"300","show-overflow-tooltip":""}),(0,t.bF)(O,{prop:"userId",label:"用户",width:"120"}),(0,t.bF)(O,{prop:"ip",label:"IP地址",width:"130"})])),_:1},8,["data"]),(0,t.Lk)("div",m,[(0,t.bF)(N,{background:"",layout:"prev, pager, next, sizes, total",total:F.value,"page-size":f.value,"page-sizes":[20,50,100,200],onSizeChange:I,onCurrentChange:_},null,8,["total","page-size"])])]))])),_:1})])}}},y=l(1241);const k=(0,y.A)(h,[["__scopeId","data-v-3da43340"]]);var D=k}}]);